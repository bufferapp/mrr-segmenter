---
title: "MRR Segmenter"
resource_files:
- mrr-segmenter.Rproj
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    orientation: rows
---

```{r setup, include = FALSE}
library(flexdashboard)
library(ggplot2)
library(plotly)
library(scales)

# get helper functions
source("mrr_source.R")

# get mrr data 
mrr <- get_mrr_data(start_date = "2019-01-01", end_date = as.character(Sys.Date()))

# set mrr and date values
mrr <- mrr %>% 
  mutate(date = as.Date(date, format = "%Y-%m-%d"),
         mrr = mrr / 100)
```

Row
-----------------------------------------------------------------------

### Publish Main Plans

```{r}
# publish forecast plot
renderPlotly({

  p <- mrr %>% 
    group_by(date) %>% 
    summarise(mrr = sum(mrr)) %>% 
    ggplot(aes(x = date, y = mrr)) +
    geom_line() +
    stat_smooth(method = "loess") +
    theme_minimal() +
    scale_y_continuous(labels = dollar) +
    labs(x = NULL, y = NULL)
  
  ggplotly(p) 
  
})
```

### Pro Plans

```{r}
# publish forecast plot
renderPlotly({

  p <- mrr %>% 
    filter(plan == "pro") %>% 
    ggplot(aes(x = date, y = mrr)) +
    geom_line() +
    stat_smooth(method = "loess") +
    theme_minimal() +
    scale_y_continuous(labels = dollar) +
    labs(x = NULL, y = NULL)
  
  ggplotly(p) 
  
})
```

### Premium Plans

```{r}
renderPlotly({

  p <- mrr %>% 
    filter(plan == "premium") %>% 
    ggplot(aes(x = date, y = mrr)) +
    geom_line() +
    stat_smooth(method = "loess") +
    theme_minimal() +
    scale_y_continuous(labels = dollar) +
    labs(x = NULL, y = NULL)
  
  ggplotly(p) 
  
})
```

Row
-----------------------------------------------------------------------

### Small Business V2

```{r}
renderPlotly({

  p <- mrr %>% 
    filter(plan == "small business v2") %>% 
    ggplot(aes(x = date, y = mrr)) +
    geom_line() +
    stat_smooth(method = "loess") +
    theme_minimal() +
    scale_y_continuous(labels = dollar) +
    labs(x = NULL, y = NULL)
  
  ggplotly(p) 
  
})
```

### Medium Business V2

```{r}
renderPlotly({

  p <- mrr %>% 
    filter(plan == "medium business v2") %>% 
    ggplot(aes(x = date, y = mrr)) +
    geom_line() +
    stat_smooth(method = "loess") +
    theme_minimal() +
    scale_y_continuous(labels = dollar) +
    labs(x = NULL, y = NULL)
  
  ggplotly(p) 
  
})
```

### Large Business V2

```{r}
renderPlotly({

  p <- mrr %>% 
    filter(plan == "large business v2") %>% 
    ggplot(aes(x = date, y = mrr)) +
    geom_line() +
    stat_smooth(method = "loess") +
    theme_minimal() +
    scale_y_continuous(labels = dollar) +
    labs(x = NULL, y = NULL)
  
  ggplotly(p) 
  
})
```

